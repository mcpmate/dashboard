# MCPMate 管理后台构建指南 - Part 1: 项目概述与核心功能模块

本文档旨在指导 `bolt.new` 构建 MCPMate 项目的管理后台。

## 1. 项目概述

MCPMate 是一个综合性的 Model Context Protocol (MCP) 管理中心，旨在解决 MCP 生态系统中的配置复杂性、资源消耗、安全风险等问题，为用户提供统一的管理平台。其核心组件包括高性能的 MCP 代理服务器 (`Proxy`) 和用于协议转换的桥接组件 (`Bridge`)。管理后台将通过 MCPMate Proxy 提供的 RESTful API 与后端进行交互。

## 2. MCPMate 核心功能模块

以下是 MCPMate 需要在管理后台实现的核心功能模块及其详细说明：

### 2.1 服务器管理 (Server Management)

**描述**: 此模块负责管理所有上游 MCP 服务器的配置、连接状态和运行实例。用户应能够通过界面方便地添加、查看、编辑和移除 MCP 服务器配置，并监控其健康状况。

**主要功能点**:
- **服务器列表**: 展示所有已配置的 MCP 服务器，包括其名称、类型 (stdio, sse, streamable_http)、当前状态（如：已连接、已断开、错误）、活动实例数等。
- **服务器详情**: 查看特定服务器的详细配置信息（命令、参数、环境变量等）及其所有运行实例的列表和状态。
- **实例管理**:
    - 列出特定服务器的所有活动实例。
    - 查看单个实例的详细信息和健康状态。
    - 对实例进行操作：断开连接、强制断开连接、重新连接、重置并重新连接。
    - 取消正在初始化的实例。
- **(未来可能支持)** 添加新的 MCP 服务器配置、编辑现有配置、删除配置。

**关联 API 域**: `/api/mcp/servers/*`

### 2.2 工具管理与聚合 (Tool Management and Aggregation)

**描述**: MCPMate Proxy 会聚合来自所有已连接 MCP 服务器的工具。此模块允许用户查看所有可用的工具，并对其进行管理。

**主要功能点**:
- **工具列表**: 展示从所有活动服务器聚合而来的全部工具列表，包括工具名称、来源服务器、当前状态（启用/禁用）等。
- **工具详情与配置**: 查看特定工具的详细配置信息。
- **工具控制**:
    - 启用或禁用特定的工具。
    - (未来可能支持) 修改工具的特定配置参数 (通过 API 实现)。

**关联 API 域**: `/api/mcp/tools/*`

### 2.3 连接管理 (Connection Management)

**描述**: 此模块主要关注 MCPMate Proxy 与客户端（如 AI 助手、IDE 插件）以及 MCPMate Proxy 与下游 MCP 服务器之间的连接状态。

**主要功能点**:
- **Proxy 连接状态**: 显示 Proxy 服务本身与各下游 MCP 服务器的连接健康度。 (大部分通过服务器管理的实例状态体现)
- **客户端连接监控**: (未来可能支持) 监控连接到 Proxy 的客户端数量和活动情况。
- **Bridge 组件状态**: (如果适用) 显示 Bridge 组件的状态及其转换的连接。

**注意**: API 中没有专门的"连接管理"域，其功能主要通过服务器实例管理和系统状态来体现。

### 2.4 配置管理 (Configuration Management)

**描述**: 虽然 MCPMate 的核心服务器配置目前通过 `mcp.json` 文件管理，但管理后台应能辅助用户理解和（未来可能）修改某些运行时配置，特别是与工具相关的设置。

**主要功能点**:
- **查看当前工具配置**: 通过工具管理模块查看工具的配置参数。
- **修改工具配置**: 允许通过 API 更新特定工具的配置。
- **(未来桌面应用功能)**:
    - 图形化编辑 `mcp.json` 或其等效配置。
    - 配置模板与版本控制。
    - 场景预设与一键切换。

### 2.5 系统监控与通知 (System Monitoring & Notifications)

**描述**: 提供对 MCPMate Proxy 服务自身运行状态的监控，并处理来自后端的通知。

**主要功能点**:
- **系统状态**: 显示 MCPMate Proxy 的整体运行状态（如：运行中、已停止、错误）。
- **系统指标**: 展示关键性能指标（如：CPU 使用率、内存占用、网络流量、活动连接数等）。
- **实时通知**: 接收并向用户展示来自后端的通知，例如工具列表发生变化。

**关联 API 域**: `/api/system/*`, `/api/notifications/*`

---

## 3. OpenAPI 驱动的开发流程（OpenAPI‑Driven Workflow）

- 本项目的前端开发严格依赖后端 OpenAPI 定义，所有接口字段、形状与错误语义以后端提供的 OpenAPI 为准。
- 本仓库包含已抓取的规范快照：`docs/openapi.json`。联调时可直接对照该文件；当后端更新时，请先刷新该文件并同步 `src/lib/api.ts` 与 `src/lib/types.ts`。
- 运行中的后端会在开发环境暴露 Live Schema：`http://127.0.0.1:8080/openapi.json`。建议在大改前比对 Live Schema 与 `docs/openapi.json` 的差异后再实施变更。
- 统一在 `src/lib/api.ts` 维护 API 封装，页面仅通过 TanStack Query 调用这些封装，避免在组件中散落 `fetch`/`URLSearchParams` 逻辑。

## 4. 联动测试与 Playwright MCP 工具

- 联动测试是必要项：功能开发完成后，需要通过页面交互+接口回执的方式进行端到端验证。
- 推荐使用 Playwright + MCP 工具（playwright mcp）进行可重复的联动测试脚本编写，覆盖以下关键路径：
  - 服务器（Servers）列表与详情页：启停、刷新、删除、Capabilities 子标签懒加载；
  - 客户端（Clients）列表排序与管理开关稳定性；
  - 客户端详情页：Apply 配置 Drawer、Backup Policy Drawer、备份还原/删除；
  - 配置（Profiles）：各能力项的启用/禁用、筛选条布局与懒加载详情；
- 运行开发服务：`bun run dev`（或 `npm run dev`），后端在 `http://localhost:8080`；Vite 已将 `/api` 与 `/ws` 代理到后端。

---

接下来的部分将详细介绍 API 端点规范。
